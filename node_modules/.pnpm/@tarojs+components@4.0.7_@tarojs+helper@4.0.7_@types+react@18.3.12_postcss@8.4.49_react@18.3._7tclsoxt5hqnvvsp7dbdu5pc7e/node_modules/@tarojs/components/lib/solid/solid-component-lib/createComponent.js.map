{"version":3,"file":"createComponent.js","sources":["../../../../taro-components-library-solid/src/solid-component-lib/createComponent.tsx"],"sourcesContent":["import { isFunction } from '@tarojs/shared'\nimport { Component, JSX, mergeProps, splitProps } from 'solid-js'\nimport h from 'solid-js/h'\nimport { effect as _$effect, memo } from 'solid-js/web'\n\nimport { camelToDashCase, isPropNameAnEvent, isReactiveKey, syncAttribute, syncEvent } from './utils'\n\nexport interface HTMLStencilElement extends HTMLElement {\n  componentOnReady(): Promise<this>\n}\n\nexport type StencilSolidInternalProps<ElementType> = JSX.DOMAttributes<ElementType>\n\nexport interface ComponentSupplementaryTypes {\n  style?: JSX.CSSProperties\n  slot?: string\n}\n\nfunction setReactiveProps(node: HTMLElement, getterObj: Record<string, any>) {\n  _$effect(() => {\n    for (const key in getterObj) {\n      syncAttribute(node, key, getterObj[key])\n    }\n  })\n}\n\nfunction syncEvents(node: HTMLElement, eventsMap: Map<string, () => void>) {\n  for (const [key, value] of eventsMap) {\n    syncEvent(node, key, value)\n  }\n}\n\nexport const createSolidComponent = <\n  PropType,\n  ElementType extends HTMLStencilElement,\n  ExpandedPropsTypes = any\n>(\n  tagName: string,\n  manipulatePropsFunction?: (\n    originalProps: StencilSolidInternalProps<ElementType>,\n    newProps: any\n  ) => ExpandedPropsTypes,\n  defineCustomElement?: () => void,\n): Component<PropType & JSX.DOMAttributes<ElementType> & ComponentSupplementaryTypes> => {\n  if (defineCustomElement !== undefined) {\n    defineCustomElement()\n  }\n\n  function SolidComponentWrapper(props: { children: JSX.Element } & any) {\n    const [local, other] = splitProps(props, ['children', 'ref'])\n    const eventsMap = new Map()\n    const reactiveKeys = []\n    const getUnTrackProps = (_props: Record<string, any>) => {\n      let propsToPass: typeof props = {}\n      for (const key in _props) {\n        if (!_props.hasOwnProperty(key)) {\n          continue\n        }\n        if (isPropNameAnEvent(key)) {\n          eventsMap.set(key, _props[key])\n          continue\n        }\n        if (isReactiveKey(_props, key)) {\n          reactiveKeys.push(key)\n          continue\n        }\n        const propValue = _props[key]\n        propsToPass[camelToDashCase(key)] = propValue\n      }\n      if (manipulatePropsFunction !== undefined) {\n        propsToPass = manipulatePropsFunction(_props, propsToPass)\n      }\n      return propsToPass\n    }\n\n    const unTrackProps = getUnTrackProps(other)\n    const [reactiveProps] = splitProps(other, reactiveKeys)\n\n    const _mergeProps = mergeProps(unTrackProps, {\n      ref: (element: HTMLElement) => {\n        if (local.ref && isFunction(local.ref)) local.ref(element)\n        syncEvents(element, eventsMap)\n        setReactiveProps(element, reactiveProps)\n      }\n    })\n\n    return memo(() => h(tagName, _mergeProps, local.children), true)\n  }\n\n  return SolidComponentWrapper as any\n}\n"],"names":["_$effect"],"mappings":";;;;;;;;AAkBA,SAAS,gBAAgB,CAAC,IAAiB,EAAE,SAA8B,EAAA;IACzEA,MAAQ,CAAC,MAAK;AACZ,QAAA,KAAK,MAAM,GAAG,IAAI,SAAS,EAAE;YAC3B,aAAa,CAAC,IAAI,EAAE,GAAG,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,CAAA;SACzC;AACH,KAAC,CAAC,CAAA;AACJ,CAAC;AAED,SAAS,UAAU,CAAC,IAAiB,EAAE,SAAkC,EAAA;IACvE,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,SAAS,EAAE;AACpC,QAAA,SAAS,CAAC,IAAI,EAAE,GAAG,EAAE,KAAK,CAAC,CAAA;KAC5B;AACH,CAAC;AAEY,MAAA,oBAAoB,GAAG,CAKlC,OAAe,EACf,uBAGuB,EACvB,mBAAgC,KACsD;AACtF,IAAA,IAAI,mBAAmB,KAAK,SAAS,EAAE;AACrC,QAAA,mBAAmB,EAAE,CAAA;KACtB;IAED,SAAS,qBAAqB,CAAC,KAAsC,EAAA;AACnE,QAAA,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,UAAU,CAAC,KAAK,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAA;AAC7D,QAAA,MAAM,SAAS,GAAG,IAAI,GAAG,EAAE,CAAA;QAC3B,MAAM,YAAY,GAAG,EAAE,CAAA;AACvB,QAAA,MAAM,eAAe,GAAG,CAAC,MAA2B,KAAI;YACtD,IAAI,WAAW,GAAiB,EAAE,CAAA;AAClC,YAAA,KAAK,MAAM,GAAG,IAAI,MAAM,EAAE;gBACxB,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;oBAC/B,SAAQ;iBACT;AACD,gBAAA,IAAI,iBAAiB,CAAC,GAAG,CAAC,EAAE;oBAC1B,SAAS,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAA;oBAC/B,SAAQ;iBACT;AACD,gBAAA,IAAI,aAAa,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE;AAC9B,oBAAA,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;oBACtB,SAAQ;iBACT;AACD,gBAAA,MAAM,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;gBAC7B,WAAW,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,CAAA;aAC9C;AACD,YAAA,IAAI,uBAAuB,KAAK,SAAS,EAAE;AACzC,gBAAA,WAAW,GAAG,uBAAuB,CAAC,MAAM,EAAE,WAAW,CAAC,CAAA;aAC3D;AACD,YAAA,OAAO,WAAW,CAAA;AACpB,SAAC,CAAA;AAED,QAAA,MAAM,YAAY,GAAG,eAAe,CAAC,KAAK,CAAC,CAAA;QAC3C,MAAM,CAAC,aAAa,CAAC,GAAG,UAAU,CAAC,KAAK,EAAE,YAAY,CAAC,CAAA;AAEvD,QAAA,MAAM,WAAW,GAAG,UAAU,CAAC,YAAY,EAAE;AAC3C,YAAA,GAAG,EAAE,CAAC,OAAoB,KAAI;gBAC5B,IAAI,KAAK,CAAC,GAAG,IAAI,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC;AAAE,oBAAA,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;AAC1D,gBAAA,UAAU,CAAC,OAAO,EAAE,SAAS,CAAC,CAAA;AAC9B,gBAAA,gBAAgB,CAAC,OAAO,EAAE,aAAa,CAAC,CAAA;aACzC;AACF,SAAA,CAAC,CAAA;AAEF,QAAA,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,WAAW,EAAE,KAAK,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAA;KACjE;AAED,IAAA,OAAO,qBAA4B,CAAA;AACrC;;;;"}