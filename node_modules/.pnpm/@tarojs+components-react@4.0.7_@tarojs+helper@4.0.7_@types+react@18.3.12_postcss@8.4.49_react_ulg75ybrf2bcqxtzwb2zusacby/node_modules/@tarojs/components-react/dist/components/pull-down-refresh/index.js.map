{"version":3,"file":"index.js","sources":["../../../src/components/pull-down-refresh/index.tsx"],"sourcesContent":["import './style/index.css'\r\n\r\nimport Taro from '@tarojs/taro'\r\nimport classNames from 'classnames'\r\nimport React from 'react'\r\n\r\nimport { createForwardRefComponent } from '../../utils/index'\r\n\r\nfunction setTransform (nodeStyle, value) {\r\n  nodeStyle.transform = value\r\n  nodeStyle.webkitTransform = value\r\n  nodeStyle.MozTransform = value\r\n}\r\n\r\nconst isWebView =\r\n  typeof navigator !== 'undefined' && /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)\r\n\r\nenum PullDownState {\r\n  activate = 'activate',\r\n  deactivate = 'deactivate',\r\n  release = 'release',\r\n  finish = 'finish'\r\n}\r\n\r\nenum INDICATOR {\r\n  activate = 'release',\r\n  deactivate = 'pull',\r\n  release = 'loading',\r\n  finish = 'finish'\r\n}\r\n\r\nlet supportsPassive = false\r\ntry {\r\n  const opts = Object.defineProperty({}, 'passive', {\r\n    get () {\r\n      supportsPassive = true\r\n    }\r\n  })\r\n  window.addEventListener('cancel', () => ({}), opts)\r\n} catch (e) {} // eslint-disable-line no-empty\r\n\r\nconst willPreventDefault = supportsPassive ? { passive: false } : false\r\n\r\ninterface IProps extends React.HTMLAttributes<HTMLBaseElement> {\r\n  prefixCls: string\r\n  distanceToRefresh: number\r\n  damping: number\r\n  indicator: INDICATOR\r\n  forwardedRef?: React.MutableRefObject<HTMLBaseElement>\r\n  onRefresh?: () => void\r\n}\r\n\r\ninterface IState {\r\n  currSt: PullDownState\r\n  dragOnEdge: boolean\r\n}\r\n\r\nclass PullDownRefresh extends React.Component<IProps, IState> {\r\n  static defaultProps = {\r\n    prefixCls: 'rmc-pull-to-refresh',\r\n    distanceToRefresh: 50,\r\n    damping: 100,\r\n    indicator: INDICATOR\r\n  }\r\n\r\n  // https://github.com/yiminghe/zscroller/blob/2d97973287135745818a0537712235a39a6a62a1/src/Scroller.js#L355\r\n  // currSt: `activate` / `deactivate` / `release` / `finish`\r\n  state = {\r\n    currSt: PullDownState.deactivate,\r\n    dragOnEdge: false\r\n  }\r\n\r\n  containerRef: HTMLElement | null\r\n  contentRef: HTMLDivElement | null\r\n  _to: Record<string, EventListener>\r\n  _ScreenY = 0\r\n  _startScreenY = 0\r\n  _lastScreenY = 0\r\n  _isMounted = false\r\n  listeners: [string, (...args: any[]) => void][] = []\r\n\r\n  get scrollContainer () {\r\n    return (\r\n      this.contentRef?.parentElement ||\r\n      this.contentRef?.closest('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page') ||\r\n      document.querySelector('.taro_router') ||\r\n      document.querySelector('.taro-tabbar__panel') ||\r\n      document.body\r\n    )\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.init()\r\n    this._isMounted = true\r\n    this.listeners = [\r\n      [\r\n        '__taroStartPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(true)\r\n            successHandler({\r\n              errMsg: 'startPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'startPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ],\r\n      [\r\n        '__taroStopPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(false)\r\n            successHandler({\r\n              errMsg: 'stopPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'stopPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ]\r\n    ]\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.on(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    this.destroy()\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.off(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentDidUpdate (_, prevState: IState) {\r\n    if (prevState.currSt !== this.state.currSt) {\r\n      const pageEl: any = this.scrollContainer\r\n      switch (this.state.currSt) {\r\n        case PullDownState.release:\r\n          pageEl?.__page?.onPullDownRefresh?.()\r\n          break\r\n        case PullDownState.deactivate:\r\n          pageEl?.__page?.onPullIntercept?.()\r\n      }\r\n    }\r\n  }\r\n\r\n  triggerPullDownRefresh = (flag: boolean) => {\r\n    // 在初始化时、用代码 自动 触发 pullDownRefresh\r\n    // 添加this._isMounted的判断，否则组建一实例化，currSt就会是finish\r\n    if (!this.state.dragOnEdge && this._isMounted) {\r\n      if (flag) {\r\n        this._lastScreenY = this.props.distanceToRefresh + 1\r\n        // change dom need after setState\r\n        this.setState({ currSt: PullDownState.release }, () => this.setContentStyle(this._lastScreenY))\r\n      } else {\r\n        this.setState({ currSt: PullDownState.finish }, () => this.reset())\r\n      }\r\n    }\r\n  }\r\n\r\n  init = () => {\r\n    const ele = this.scrollContainer\r\n    this._to = {\r\n      touchstart: this.onTouchStart.bind(this, ele),\r\n      touchmove: this.onTouchMove.bind(this, ele),\r\n      touchend: this.onTouchEnd.bind(this, ele),\r\n      touchcancel: this.onTouchEnd.bind(this, ele)\r\n    }\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.addEventListener(key, this._to[key], willPreventDefault)\r\n    })\r\n  }\r\n\r\n  destroy = () => {\r\n    if (!this._to) return\r\n\r\n    const ele = this.scrollContainer\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.removeEventListener(key, this._to[key])\r\n    })\r\n  }\r\n\r\n  onTouchStart = (_, e: TouchEvent) => {\r\n    this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n    // 一开始 refreshing 为 true 时 this._lastScreenY 有值\r\n    this._lastScreenY = this._lastScreenY || 0\r\n  }\r\n\r\n  isEdge = (ele: HTMLElement) => {\r\n    const container = this.scrollContainer\r\n    if (container && container === document.body) {\r\n      // In chrome61 `document.body.scrollTop` is invalid\r\n      const scrollNode = document.scrollingElement ? document.scrollingElement : document.body\r\n      return scrollNode.scrollTop <= 0\r\n    }\r\n    return ele.scrollTop <= 0\r\n  }\r\n\r\n  damping = (dy: number) => {\r\n    if (Math.abs(this._lastScreenY) > this.props.damping) {\r\n      return 0\r\n    }\r\n\r\n    const ratio = Math.abs(this._ScreenY - this._startScreenY) / window.screen.height\r\n    dy *= (1 - ratio) * 0.6\r\n\r\n    return dy\r\n  }\r\n\r\n  onTouchMove = (ele: HTMLElement, e: TouchEvent) => {\r\n    // 使用 pageY 对比有问题\r\n    const _screenY = e.touches[0].screenY\r\n\r\n    // 拖动方向不符合的不处理\r\n    if (this._startScreenY > _screenY) {\r\n      return\r\n    }\r\n\r\n    if (this.isEdge(ele)) {\r\n      if (!this.state.dragOnEdge) {\r\n        // 当用户开始往上滑的时候isEdge还是false的话，会导致this._ScreenY不是想要的，只有当isEdge为true时，再上滑，才有意义\r\n        // 下面这行代码解决了上面这个问题\r\n        this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n        this.setState({ dragOnEdge: true })\r\n      }\r\n      if (e.cancelable) {\r\n        e.preventDefault()\r\n      }\r\n      // add stopPropagation with fastclick will trigger content onClick event. why?\r\n      // ref https://github.com/ant-design/ant-design-mobile/issues/2141\r\n      // e.stopPropagation();\r\n\r\n      const _diff = Math.round(_screenY - this._ScreenY)\r\n      this._ScreenY = _screenY\r\n      this._lastScreenY += this.damping(_diff)\r\n\r\n      this.setContentStyle(this._lastScreenY)\r\n\r\n      if (Math.abs(this._lastScreenY) < this.props.distanceToRefresh) {\r\n        if (this.state.currSt !== PullDownState.deactivate) {\r\n          // console.log('back to the distance');\r\n          this.setState({ currSt: PullDownState.deactivate })\r\n        }\r\n      } else {\r\n        if (this.state.currSt === PullDownState.deactivate) {\r\n          // console.log('reach to the distance');\r\n          this.setState({ currSt: PullDownState.activate })\r\n        }\r\n      }\r\n\r\n      // https://github.com/ant-design/ant-design-mobile/issues/573#issuecomment-339560829\r\n      // iOS UIWebView issue, It seems no problem in WKWebView\r\n      if (isWebView && e.changedTouches[0].clientY < 0) {\r\n        this.onTouchEnd()\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchEnd = () => {\r\n    if (this.state.dragOnEdge) {\r\n      this.setState({ dragOnEdge: false })\r\n    }\r\n    if (this.state.currSt === PullDownState.activate) {\r\n      this.setState({ currSt: PullDownState.release })\r\n      this.props.onRefresh?.()\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else if (this.state.currSt === 'release') {\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else {\r\n      this.reset()\r\n    }\r\n  }\r\n\r\n  reset = () => {\r\n    this._lastScreenY = 0\r\n    this.setContentStyle(0)\r\n  }\r\n\r\n  setContentStyle = ty => {\r\n    // TODO: Why sometimes do not have `this.contentRef` ?\r\n    if (this.contentRef) {\r\n      // translate3d 不清理 会影响内部元素定位\r\n      if (ty) {\r\n        setTransform(this.contentRef.style, `translate3d(0px,${ty}px,0)`)\r\n      } else {\r\n        setTransform(this.contentRef.style, '')\r\n      }\r\n    }\r\n  }\r\n\r\n  render () {\r\n    const props: Partial<IProps> & {\r\n      children?: React.ReactNode\r\n    } = { ...this.props }\r\n    delete props.damping\r\n    delete props.indicator\r\n    delete props.distanceToRefresh\r\n    delete props.onRefresh\r\n\r\n    const { className, prefixCls, children, forwardedRef, ...restProps } = props\r\n\r\n    const renderRefresh = (cls: string) => {\r\n      const { currSt, dragOnEdge } = this.state\r\n      const cla = classNames(cls, !dragOnEdge && `${prefixCls}-transition`)\r\n      const showIndicator = currSt === 'activate' || currSt === 'release'\r\n      return (\r\n        <div className={`${prefixCls}-content-wrapper`}>\r\n          <div\r\n            className={cla}\r\n            ref={el => {\r\n              this.contentRef = el\r\n            }}\r\n          >\r\n            {showIndicator && (\r\n              <div className={`${prefixCls}-indicator`}>\r\n                <div />\r\n                <div />\r\n                <div />\r\n              </div>\r\n            )}\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (this.scrollContainer) {\r\n      return renderRefresh(`${prefixCls}-content ${prefixCls}-down`)\r\n    }\r\n    return (\r\n      <pull-down-refresh\r\n        ref={el => {\r\n          if (forwardedRef) {\r\n            forwardedRef.current = el\r\n          }\r\n          this.containerRef = el\r\n        }}\r\n        className={classNames(className, prefixCls, `${prefixCls}-down`)}\r\n        {...restProps}\r\n      >\r\n        {renderRefresh(`${prefixCls}-content`)}\r\n      </pull-down-refresh>\r\n    )\r\n  }\r\n}\r\n\r\nexport default createForwardRefComponent(PullDownRefresh)\r\n"],"names":["setTransform","nodeStyle","value","transform","webkitTransform","MozTransform","isWebView","navigator","test","userAgent","PullDownState","INDICATOR","supportsPassive","opts","Object","defineProperty","get","window","addEventListener","e","willPreventDefault","passive","PullDownRefresh","React","Component","constructor","state","currSt","deactivate","dragOnEdge","_ScreenY","_startScreenY","_lastScreenY","_isMounted","listeners","triggerPullDownRefresh","flag","props","distanceToRefresh","setState","release","setContentStyle","finish","reset","init","ele","scrollContainer","_to","touchstart","onTouchStart","bind","touchmove","onTouchMove","touchend","onTouchEnd","touchcancel","keys","forEach","key","destroy","removeEventListener","_","touches","screenY","isEdge","container","document","body","scrollNode","scrollingElement","scrollTop","damping","dy","Math","abs","ratio","screen","height","_screenY","cancelable","preventDefault","_diff","round","activate","changedTouches","clientY","_b","onRefresh","ty","contentRef","style","_a","parentElement","closest","querySelector","componentDidMount","_ref","successHandler","errorHandler","errMsg","_ref2","_ref3","evtName","callback","Taro","eventCenter","on","componentWillUnmount","_ref4","off","componentDidUpdate","prevState","pageEl","__page","onPullDownRefresh","call","_d","_c","onPullIntercept","render","assign","indicator","className","prefixCls","children","forwardedRef","restProps","__rest","renderRefresh","cls","cla","classNames","showIndicator","_jsx","_jsxs","ref","el","current","containerRef","defaultProps","createForwardRefComponent"],"mappings":"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"}