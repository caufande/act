{"version":3,"file":"index.js","sources":["../../../../src/components/button/index.tsx"],"sourcesContent":["import './style/index.scss'\n\nimport classNames from 'classnames'\n\nimport { createForwardRefComponent, omit } from '../../utils'\nimport { useEffect, useRef, useState } from '../../utils/hooks'\n\nimport type React from 'react'\n\ninterface IProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'type'> {\n  size?: string\n  plain?: boolean\n  hoverClass?: string\n  hoverStartTime?: number\n  hoverStayTime?: number\n  disabled?: boolean\n  loading?: boolean\n  type?: string\n  className?: string\n  forwardedRef?: React.MutableRefObject<HTMLButtonElement>\n}\n\ninterface IState {\n  hover:boolean\n  touch: boolean\n}\n\nfunction Button (props: IProps) {\n  const startTimer = useRef<ReturnType<typeof setTimeout>>()\n  const endTimer = useRef<ReturnType<typeof setTimeout>>()\n  const [state, setState] = useState<IState>({\n    hover: false,\n    touch: false\n  })\n\n  useEffect(() => {\n    return () => {\n      startTimer.current && clearTimeout(startTimer.current)\n      endTimer.current && clearTimeout(endTimer.current)\n    }\n  }, [])\n\n  const _onTouchStart = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: true\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      startTimer.current = setTimeout(() => {\n        if ((state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: true\n          }))\n        }\n      }, props.hoverStartTime || 20)\n    }\n    props.onTouchStart && props.onTouchStart(e)\n  }\n\n  const _onTouchEnd = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: false\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      endTimer.current = setTimeout(() => {\n        if (!(state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: false\n          }))\n        }\n      }, props.hoverStayTime || 70)\n    }\n    props.onTouchEnd && props.onTouchEnd(e)\n  }\n\n  const { forwardedRef, plain = false, children, disabled = false, className, style, onClick, hoverClass = 'button-hover', loading = false, type, ...restProps } = props\n\n  const cls = classNames(\n    className,\n    'taro-button-core',\n    {\n      [`${hoverClass}`]: (state as IState).hover && !disabled\n    }\n  )\n\n  return (\n    <button\n      {...omit(restProps, ['hoverClass', 'onTouchStart', 'onTouchEnd', 'type', 'loading', 'forwardedRef'])}\n      type={type}\n      ref={forwardedRef}\n      className={cls}\n      style={style}\n      onClick={onClick}\n      disabled={disabled}\n      onTouchStart={_onTouchStart}\n      onTouchEnd={_onTouchEnd}\n      loading={loading.toString()}\n      plain={plain.toString()}\n    >\n      {!!loading && <i className='weui-loading' />}\n      {children}\n    </button>\n  )\n}\n\nexport default createForwardRefComponent(Button)\n"],"names":["Button","props","startTimer","useRef","endTimer","state","setState","useState","hover","touch","useEffect","current","clearTimeout","_onTouchStart","e","Object","assign","hoverClass","disabled","setTimeout","hoverStartTime","onTouchStart","_onTouchEnd","hoverStayTime","onTouchEnd","forwardedRef","plain","children","className","style","onClick","loading","type","restProps","__rest","cls","classNames","_el$","_tmpl$","_$use","_$spread","_$mergeProps","omit","toString","_$insert","_tmpl$2","createForwardRefComponent"],"mappings":"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"}