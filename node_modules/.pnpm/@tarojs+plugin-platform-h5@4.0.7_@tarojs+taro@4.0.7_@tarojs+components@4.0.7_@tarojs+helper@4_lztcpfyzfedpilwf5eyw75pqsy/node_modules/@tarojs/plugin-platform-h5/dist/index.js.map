{"version":3,"file":"index.js","sources":["../src/program.ts","../src/index.ts"],"sourcesContent":["import path from 'node:path'\n\nimport { transformAsync } from '@babel/core'\nimport { defaultMainFields, SCRIPT_EXT } from '@tarojs/helper'\nimport { TaroPlatformWeb } from '@tarojs/service'\n\nimport { resolveSync } from './utils'\n\nimport type { IPluginContext, TConfig } from '@tarojs/service'\n\nconst compLibraryAlias = {\n  vue3: 'vue3',\n  solid: 'solid',\n}\n\nconst PACKAGE_NAME = '@tarojs/plugin-platform-h5'\nexport default class H5 extends TaroPlatformWeb {\n  platform = 'h5'\n  runtimePath: string[] | string = `${PACKAGE_NAME}/dist/runtime`\n\n  constructor(ctx: IPluginContext, config: TConfig) {\n    super(ctx, config)\n    this.setupTransaction.addWrapper({\n      close() {\n        this.compiler === 'webpack5' ? this.modifyWebpackConfig() : this.modifyViteConfig()\n      },\n    })\n  }\n\n  get framework() {\n    return this.ctx.initialConfig.framework || 'react'\n  }\n\n  get useHtmlComponents() {\n    return !!this.ctx.initialConfig.h5?.useHtmlComponents\n  }\n\n  get useDeprecatedAdapterComponent() {\n    return !!this.ctx.initialConfig.h5?.useDeprecatedAdapterComponent\n  }\n\n  get apiLibrary() {\n    return require.resolve('./runtime/apis')\n  }\n\n  get aliasFramework(): string {\n    return compLibraryAlias[this.framework] || 'react'\n  }\n\n  protected mainFields = [...defaultMainFields]\n\n  get componentLibrary() {\n    if (this.useHtmlComponents && this.aliasFramework === 'react') {\n      if (this.framework === 'solid') {\n        return require.resolve('@tarojs/components-react/dist/solid')\n      }\n      return require.resolve('./runtime/components')\n    } else if (this.useDeprecatedAdapterComponent) {\n      return require.resolve(`@tarojs/components/lib/${this.aliasFramework}/component-lib`)\n    } else {\n      return require.resolve(`@tarojs/components/lib/${this.aliasFramework}`)\n    }\n  }\n\n  get componentAdapter() {\n    return path.join(path.dirname(require.resolve('@tarojs/components')), '..', 'lib')\n  }\n\n  get routerLibrary() {\n    const name = '@tarojs/router'\n    return (\n      resolveSync(name, {\n        // basedir: this.ctx.paths.appPath,\n        mainFields: this.mainFields,\n      }) || name\n    )\n  }\n\n  get libraryDefinition() {\n    return resolveSync('./definition.json', {\n      basedir: __dirname,\n    })!\n  }\n\n  /**\n   * 修改 Webpack 配置\n   */\n  modifyWebpackConfig() {\n    this.ctx.modifyWebpackChain?.(({ chain }) => {\n      // Note: 更新 mainFields 配置，确保 resolveSync 能正确读取到相关依赖入口文件\n      const mainFields = chain.resolve.mainFields.values() || [...defaultMainFields]\n      if (mainFields.length > 0) {\n        this.mainFields = mainFields\n      }\n\n      const rules = chain.module.rules\n      const script = rules.get('script')\n      const babelLoader = script.uses.get('babelLoader')\n      babelLoader.set('options', {\n        ...babelLoader.get('options'),\n        plugins: [\n          [\n            require('babel-plugin-transform-taroapi'),\n            {\n              packageName: '@tarojs/taro',\n              definition: require(this.libraryDefinition),\n            },\n          ],\n        ],\n      })\n\n      const alias = chain.resolve.alias\n      // TODO 考虑集成到 taroComponentsPath 中，与小程序端对齐\n      alias.set('@tarojs/components$', this.componentLibrary)\n      alias.set('@tarojs/components/lib', this.componentAdapter)\n      alias.set('@tarojs/router$', this.routerLibrary)\n      alias.set('@tarojs/taro', this.apiLibrary)\n      chain.plugin('mainPlugin').tap((args) => {\n        args[0].loaderMeta ||= {\n          extraImportForWeb: '',\n          execBeforeCreateWebApp: '',\n        }\n\n        // Note: 旧版本适配器不会自动注册 Web Components 组件，需要加载 defineCustomElements 脚本自动注册使用的组件\n        if (this.useDeprecatedAdapterComponent) {\n          args[0].loaderMeta.extraImportForWeb += `import { applyPolyfills, defineCustomElements } from '@tarojs/components/loader'\\n`\n          args[0].loaderMeta.execBeforeCreateWebApp += `applyPolyfills().then(() => defineCustomElements(window))\\n`\n        }\n\n        if (!this.useHtmlComponents) {\n          args[0].loaderMeta.extraImportForWeb += `import { defineCustomElementTaroPullToRefreshCore } from '@tarojs/components/dist/components'\\n`\n          args[0].loaderMeta.execBeforeCreateWebApp += `defineCustomElementTaroPullToRefreshCore()\\n`\n        }\n\n        switch (this.framework) {\n          case 'vue3':\n            args[0].loaderMeta.extraImportForWeb += `import { initVue3Components } from '@tarojs/components/lib/vue3/components-loader'\\nimport * as list from '@tarojs/components'\\n`\n            args[0].loaderMeta.execBeforeCreateWebApp += `initVue3Components(component, list)\\n`\n            break\n          default:\n            if (this.useHtmlComponents) {\n              args[0].loaderMeta.extraImportForWeb += `import '${require.resolve('@tarojs/components-react/dist/index.css')}'\\nimport { PullDownRefresh } from '@tarojs/components'\\n`\n              args[0].loaderMeta.execBeforeCreateWebApp += `config.PullDownRefresh = PullDownRefresh\\n`\n            }\n        }\n        return args\n      })\n\n      // Note: 本地调试 stencil 组件库时，如果启用 sourceMap 则需要相关配置\n      chain.module\n        .rule('map')\n        .test(/\\.map$/)\n        .type('json')\n    })\n  }\n\n  /**\n   * 修改 Vite 配置\n   */\n  modifyViteConfig() {\n    const that = this\n    const { runnerUtils } = this.ctx\n    const { getViteH5CompilerContext } = runnerUtils\n    that.ctx.modifyViteConfig?.(({ viteConfig }) => {\n      function aliasPlugin() {\n        return {\n          name: 'taro:vite-h5-alias',\n          config: () => ({\n            resolve: {\n              alias: [\n                { find: /@tarojs\\/components$/, replacement: that.componentLibrary },\n                { find: '@tarojs/components/lib', replacement: that.componentAdapter },\n                { find: /@tarojs\\/router$/, replacement: that.routerLibrary },\n                { find: '@tarojs/taro', replacement: that.apiLibrary },\n              ],\n            },\n          }),\n        }\n      }\n      function injectLoaderMeta() {\n        return {\n          name: 'taro:vite-h5-loader-meta',\n          async buildStart () {\n            const viteCompilerContext = await getViteH5CompilerContext(this)\n            if (viteCompilerContext) {\n              viteCompilerContext.loaderMeta ||= {\n                extraImportForWeb: '',\n                execBeforeCreateWebApp: '',\n              }\n\n              // Note: 旧版本适配器不会自动注册 Web Components 组件，需要加载 defineCustomElements 脚本自动注册使用的组件\n              if (that.useDeprecatedAdapterComponent) {\n                viteCompilerContext.loaderMeta.extraImportForWeb += `import { applyPolyfills, defineCustomElements } from '@tarojs/components/loader'\\n`\n                viteCompilerContext.loaderMeta.execBeforeCreateWebApp += `applyPolyfills().then(() => defineCustomElements(window))\\n`\n              }\n\n              if (!that.useHtmlComponents) {\n                viteCompilerContext.loaderMeta.extraImportForWeb += `import { defineCustomElementTaroPullToRefreshCore } from '@tarojs/components/dist/components'\\n`\n                viteCompilerContext.loaderMeta.execBeforeCreateWebApp += `defineCustomElementTaroPullToRefreshCore()\\n`\n              }\n\n              switch (that.framework) {\n                case 'vue3':\n                  viteCompilerContext.loaderMeta.extraImportForWeb += `import { initVue3Components } from '@tarojs/components/lib/vue3/components-loader'\\nimport * as list from '@tarojs/components'\\n`\n                  viteCompilerContext.loaderMeta.execBeforeCreateWebApp += `initVue3Components(component, list)\\n`\n                  break\n                default:\n                  if (that.useHtmlComponents) {\n                    viteCompilerContext.loaderMeta.extraImportForWeb += `import { PullDownRefresh } from '@tarojs/components'\\n`\n                    viteCompilerContext.loaderMeta.execBeforeCreateWebApp += `config.PullDownRefresh = PullDownRefresh\\n`\n                  }\n              }\n            }\n          },\n        }\n      }\n      function apiPlugin() {\n        return {\n          name: 'taro:vite-h5-api',\n          enforce: 'post',\n          async transform(code, id) {\n            const viteCompilerContext = await getViteH5CompilerContext(this)\n            if (viteCompilerContext) {\n              const exts = Array.from(new Set(viteCompilerContext.frameworkExts.concat(SCRIPT_EXT)))\n              if (id.startsWith(viteCompilerContext.sourceDir) && exts.some((ext) => id.includes(ext))) {\n                // @TODO 后续考虑使用 SWC 插件的方式实现\n                const result = await transformAsync(code, {\n                  filename: id,\n                  plugins: [\n                    [\n                      require('babel-plugin-transform-taroapi'),\n                      {\n                        packageName: '@tarojs/taro',\n                        definition: require(that.libraryDefinition)\n                      },\n                    ],\n                  ],\n                })\n                return {\n                  code: result?.code || code,\n                  map: result?.map || null,\n                }\n              }\n            }\n          },\n        }\n      }\n      viteConfig.plugins.push(aliasPlugin())\n      viteConfig.plugins.push(injectLoaderMeta())\n      viteConfig.plugins.push(apiPlugin())\n    })\n  }\n}\n","import H5 from './program'\n\nimport type { IPluginContext } from '@tarojs/service'\n\n// Note: 让其它平台插件可以继承此平台\nexport { H5 }\n\nexport default (ctx: IPluginContext) => {\n  ctx.registerPlatform({\n    name: 'h5',\n    useConfigName: 'h5',\n    async fn ({ config }) {\n      const program = new H5(ctx, config)\n      await program.start()\n    }\n  })\n}\n\nexport * from './utils'\n"],"names":["TaroPlatformWeb","defaultMainFields","resolveSync","SCRIPT_EXT","transformAsync","__awaiter"],"mappings":"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"}