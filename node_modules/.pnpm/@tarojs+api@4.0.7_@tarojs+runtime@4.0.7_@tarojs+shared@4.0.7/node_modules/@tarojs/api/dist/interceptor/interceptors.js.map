{"version":3,"file":"interceptors.js","sources":["../../src/interceptor/interceptors.ts"],"sourcesContent":["import { isFunction, isUndefined } from '@tarojs/shared'\n\nimport type Chain from './chain'\n\nexport function timeoutInterceptor (chain: Chain) {\n  const requestParams = chain.requestParams\n  let p: Promise<void>\n  const res = new Promise<void>((resolve, reject) => {\n    const timeout: ReturnType<typeof setTimeout> = setTimeout(() => {\n      clearTimeout(timeout)\n      reject(new Error('网络链接超时,请稍后再试！'))\n    }, (requestParams && requestParams.timeout) || 60000)\n\n    p = chain.proceed(requestParams)\n    p\n      .then(res => {\n        if (!timeout) return\n        clearTimeout(timeout)\n        resolve(res)\n      })\n      .catch(err => {\n        timeout && clearTimeout(timeout)\n        reject(err)\n      })\n  })\n  // @ts-ignore\n  if (!isUndefined(p) && isFunction(p.abort)) res.abort = p.abort\n\n  return res\n}\n\nexport function logInterceptor (chain: Chain) {\n  const requestParams = chain.requestParams\n  const { method, data, url } = requestParams\n\n  // eslint-disable-next-line no-console\n  console.log(`http ${method || 'GET'} --> ${url} data: `, data)\n\n  const p = chain.proceed(requestParams)\n  const res = p\n    .then(res => {\n      // eslint-disable-next-line no-console\n      console.log(`http <-- ${url} result:`, res)\n      return res\n    })\n  // @ts-ignore\n  if (isFunction(p.abort)) res.abort = p.abort\n\n  return res\n}\n"],"names":[],"mappings":";;AAIM,SAAU,kBAAkB,CAAE,KAAY,EAAA;AAC9C,IAAA,MAAM,aAAa,GAAG,KAAK,CAAC,aAAa,CAAA;AACzC,IAAA,IAAI,CAAgB,CAAA;IACpB,MAAM,GAAG,GAAG,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,KAAI;AAChD,QAAA,MAAM,OAAO,GAAkC,UAAU,CAAC,MAAK;YAC7D,YAAY,CAAC,OAAO,CAAC,CAAA;AACrB,YAAA,MAAM,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAA;SACnC,EAAE,CAAC,aAAa,IAAI,aAAa,CAAC,OAAO,KAAK,KAAK,CAAC,CAAA;AAErD,QAAA,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;QAChC,CAAC;aACE,IAAI,CAAC,GAAG,IAAG;AACV,YAAA,IAAI,CAAC,OAAO;gBAAE,OAAM;YACpB,YAAY,CAAC,OAAO,CAAC,CAAA;YACrB,OAAO,CAAC,GAAG,CAAC,CAAA;AACd,SAAC,CAAC;aACD,KAAK,CAAC,GAAG,IAAG;AACX,YAAA,OAAO,IAAI,YAAY,CAAC,OAAO,CAAC,CAAA;YAChC,MAAM,CAAC,GAAG,CAAC,CAAA;AACb,SAAC,CAAC,CAAA;AACN,KAAC,CAAC,CAAA;;IAEF,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC;AAAE,QAAA,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAA;AAE/D,IAAA,OAAO,GAAG,CAAA;AACZ,CAAC;AAEK,SAAU,cAAc,CAAE,KAAY,EAAA;AAC1C,IAAA,MAAM,aAAa,GAAG,KAAK,CAAC,aAAa,CAAA;IACzC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,aAAa,CAAA;;AAG3C,IAAA,OAAO,CAAC,GAAG,CAAC,CAAA,KAAA,EAAQ,MAAM,IAAI,KAAK,CAAA,KAAA,EAAQ,GAAG,CAAA,OAAA,CAAS,EAAE,IAAI,CAAC,CAAA;IAE9D,MAAM,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;IACtC,MAAM,GAAG,GAAG,CAAC;SACV,IAAI,CAAC,GAAG,IAAG;;QAEV,OAAO,CAAC,GAAG,CAAC,CAAA,SAAA,EAAY,GAAG,CAAU,QAAA,CAAA,EAAE,GAAG,CAAC,CAAA;AAC3C,QAAA,OAAO,GAAG,CAAA;AACZ,KAAC,CAAC,CAAA;;AAEJ,IAAA,IAAI,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC;AAAE,QAAA,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAA;AAE5C,IAAA,OAAO,GAAG,CAAA;AACZ;;;;"}