{"version":3,"file":"chain.js","sources":["../../src/interceptor/chain.ts"],"sourcesContent":["import { isFunction } from '@tarojs/shared'\n\nexport type TInterceptor = (c: Chain) => Promise<void>\n\nexport interface IRequestParams {\n  timeout?: number\n  method?: string\n  url?: string\n  data?: unknown\n}\n\nexport default class Chain {\n  index: number\n  requestParams: IRequestParams\n  interceptors: TInterceptor[]\n\n  constructor (requestParams?: IRequestParams, interceptors?: TInterceptor[], index?: number) {\n    this.index = index || 0\n    this.requestParams = requestParams || {}\n    this.interceptors = interceptors || []\n  }\n\n  proceed (requestParams: IRequestParams = {}) {\n    this.requestParams = requestParams\n    if (this.index >= this.interceptors.length) {\n      throw new Error('chain 参数错误, 请勿直接修改 request.chain')\n    }\n    const nextInterceptor = this._getNextInterceptor()\n    const nextChain = this._getNextChain()\n    const p = nextInterceptor(nextChain)\n    const res = p.catch(err => Promise.reject(err))\n    Object.keys(p).forEach(k => isFunction(p[k]) && (res[k] = p[k]))\n    return res\n  }\n\n  _getNextInterceptor () {\n    return this.interceptors[this.index]\n  }\n\n  _getNextChain () {\n    return new Chain(this.requestParams, this.interceptors, this.index + 1)\n  }\n}\n"],"names":[],"mappings":";;AAWc,MAAO,KAAK,CAAA;AAKxB,IAAA,WAAA,CAAa,aAA8B,EAAE,YAA6B,EAAE,KAAc,EAAA;AACxF,QAAA,IAAI,CAAC,KAAK,GAAG,KAAK,IAAI,CAAC,CAAA;AACvB,QAAA,IAAI,CAAC,aAAa,GAAG,aAAa,IAAI,EAAE,CAAA;AACxC,QAAA,IAAI,CAAC,YAAY,GAAG,YAAY,IAAI,EAAE,CAAA;KACvC;IAED,OAAO,CAAE,gBAAgC,EAAE,EAAA;AACzC,QAAA,IAAI,CAAC,aAAa,GAAG,aAAa,CAAA;QAClC,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;AAC1C,YAAA,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAA;SACpD;AACD,QAAA,MAAM,eAAe,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAA;AAClD,QAAA,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,EAAE,CAAA;AACtC,QAAA,MAAM,CAAC,GAAG,eAAe,CAAC,SAAS,CAAC,CAAA;AACpC,QAAA,MAAM,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAA;AAC/C,QAAA,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;AAChE,QAAA,OAAO,GAAG,CAAA;KACX;IAED,mBAAmB,GAAA;QACjB,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;KACrC;IAED,aAAa,GAAA;AACX,QAAA,OAAO,IAAI,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAA;KACxE;AACF;;;;"}